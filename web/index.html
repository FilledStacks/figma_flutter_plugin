<base href="$FLUTTER_BASE_HREF">
<div id="output"></div>
<script src="flutter.js" defer></script>
<script id="app" src="main.dart.js" defer></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500">
<style>
  html {
    scroll-behavior: smooth;
  }

  body {
    height: 100%;
    width: 100%;
    margin: 0;
    padding: 0;
    font-family: Roboto, sans-serif;
  }

  #output {
    width: 100vw;
    height: 100vh;
  }
</style>
<script>
  const output = document.getElementById('output');
  const baseUrl = 'https://rodydavis.github.io/figma_flutter_plugin/';
  window.addEventListener('load', function (ev) {
    _flutter.loader._onEntrypointLoaded = function (engineInitializer) {
      engineInitializer.initializeEngine({
        hostElement: output,
        renderer: 'html',
        assetBase: baseUrl,
        canvasKitBaseUrl: baseUrl,
      }).then(function (appRunner) {
        appRunner.runApp();
      });
    };
    _flutter.loader._scriptLoaded = true;

    // Load fonts
    window.fetch(`${baseUrl}assets/FontManifest.json`).then((response) => {
      return response.json();
    }).then((assets) => {
      for (const { family, fonts } of assets) {
        for (const { asset } of fonts) {
          window.fetch(`${baseUrl}assets/${asset}`).then((res) => {
            return res.arrayBuffer();
          }).then((arrayBuffer) => {
            const bytes = new Uint8Array(arrayBuffer);
            const event = new CustomEvent('font', {
              detail: { family, buffer: bytes },
            });
            output.dispatchEvent(event);
          });
        }
      }
    });
  });
  window.onmessage = (event) => {
    const ev = new CustomEvent('figma', {
      detail: event.data.pluginMessage,
    });
    output.dispatchEvent(ev);
  };
</script>